# More documentation about how to customize your build
# can be found here:
# https://docs.fastlane.tools
fastlane_version "2.68.0"

default_platform :android

private_lane :set_version do |options|
  if options[:version]
    add_git_tag(tag: options[:version])
  end
end

private_lane :build do |options|
  set_version(options)

  # build the debug/live variant
  build_android_app(task: "clean")
  build_android_app(task: "assemble",
                    flavor: "Live",
                    build_type: "Debug",
                    properties: {
                      "vCode" => number_of_commits,
                      "vName" => last_git_tag
                     })
end

lane :alpha do |options|
  build(options)

  # upload to Crashlytics
  crashlytics(
    api_token: ENV["CRASHLYTICS_API_TOKEN"],
    build_secret: ENV["CRASHLYTICS_BUILD_SECRET"],
    groups: ["developers"]
  )
end

lane :beta do |options|
  build(options)

  # upload to Crashlytics
  crashlytics(
    api_token: ENV["CRASHLYTICS_API_TOKEN"],
    build_secret: ENV["CRASHLYTICS_BUILD_SECRET"],
    groups: ["developers", "android-testers"]
  )

end
